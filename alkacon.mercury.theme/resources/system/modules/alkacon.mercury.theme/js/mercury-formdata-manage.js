"use strict";(self.webpackChunkmercury_template=self.webpackChunkmercury_template||[]).push([[763],{449:function(e,t,s){s.r(t),s.d(t,{init:function(){return c}});class i{constructor(e,t){this.m_dialog=t,this.m_button=e.querySelector("#"+this.action+"_button_"+this.itemId),this.m_button.addEventListener("click",(()=>{this.m_dialog.showModal()})),this.m_dialog.addEventListener("close",(()=>{this.onConfirm()}))}get action(){return this.m_dialog.dataset.action}get contentId(){return this.m_dialog.dataset.contentId}get itemId(){return this.m_dialog.dataset.itemId}get formmanage(){return new URLSearchParams(location.search).get("formmanage")}onConfirm(){"confirm"==this.m_dialog.returnValue&&(location.href="?formmanage="+this.formmanage+"&action="+this.action+"&uuid="+this.contentId)}}class n{constructor(e,t){if(this.m_submissionsSelect=t,this.m_button=e.querySelector(".submissions-dialog-delete-button"),this.m_dialog=e.querySelector(".submissions-dialog-delete"),this.m_dialog){this.m_buttonCancel=this.m_dialog.querySelector(".button-cancel"),this.m_buttonConfirm=this.m_dialog.querySelector(".button-confirm"),this.m_messageDeleteAll=this.m_dialog.querySelector(".delete-all"),this.m_messageDeleteSelected=this.m_dialog.querySelector(".delete-selected"),this.m_response=this.m_dialog.querySelector(".delete-response");this.m_button&&this.m_dialog&&this.m_messageDeleteAll&&this.m_messageDeleteSelected&&this.m_buttonCancel&&this.m_buttonConfirm&&(this.m_button.addEventListener("click",(()=>{this.onOpen()})),this.m_buttonCancel.addEventListener("click",(()=>{this.onCancel()})),this.m_buttonConfirm.addEventListener("click",(()=>{this.onConfirm()})),this.m_messageDeleteSelected.style.display="none")}}get action(){return this.m_dialog.dataset.action}get formmanage(){return new URLSearchParams(location.search).get("formmanage")}createHttpClient(e){const t=new XMLHttpRequest;return t.open("POST",e,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t}deleteAll(){const e=this,t=this.createHttpClient(this.action);t.send(""),t.onload=function(){e.m_response.innerHTML=this.responseText,location.href="?reload"},t.onerror=function(){e.m_response.innerHTML=this.responseText}}deleteSelected(){const e=this,t=this.createHttpClient(this.action),s=this.m_submissionsSelect.getCheckedItemIds(),i=0==s.length?"":"formdata="+s.join(",");t.send(i),t.onload=function(){e.m_response.innerHTML=this.responseText,location.href="?reload"},t.onerror=function(){e.m_response.innerHTML=this.responseText}}onCancel(){this.m_dialog.close()}onConfirm(){this.m_submissionsSelect.isModeSelect()?this.deleteSelected():this.deleteAll()}onOpen(){this.m_submissionsSelect.isModeSelect()?(this.m_messageDeleteAll.style.display="none",this.m_messageDeleteSelected.style.display="block"):(this.m_messageDeleteAll.style.display="block",this.m_messageDeleteSelected.style.display="none"),this.m_dialog.showModal()}}class o{constructor(e,t){this.m_submissionsSelect=t,this.m_buttonExportCsv=e.querySelector(".btn-export-csv"),this.m_buttonExportExcel=e.querySelector(".btn-export-excel");this.m_buttonExportCsv&&this.m_buttonExportExcel&&(this.m_buttonExportCsv.addEventListener("click",(e=>this.onExport(e))),this.m_buttonExportExcel.addEventListener("click",(e=>this.onExport(e))))}createHttpClient(e){const t=new XMLHttpRequest;return t.open("POST",e,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.responseType="arraybuffer",t}onExport(e){if(this.m_submissionsSelect.isModeSelect()){e.preventDefault();const t=this.createHttpClient(e.target.href),s=this.m_submissionsSelect.isSelectAll()?"":"formdata="+this.m_submissionsSelect.getCheckedItemIds().join(",");t.send(s),t.onload=function(){const e=this.getResponseHeader("Content-Type"),t=this.getResponseHeader("Content-Disposition");let s="download";t.includes("filename=")&&(s=t.substring(t.indexOf("filename=")+9));const i=this.response,n=new Blob([i],{type:e});n.name=s;const o=new FileReader;o.onload=e=>{const t=document.createElement("a");t.style.display="none",t.href=e.target.result,t.download=s,t.click()},o.readAsDataURL(n)}}}}class l{constructor(e){this.m_itemSelectStart=e.querySelector(".acco-item-select-start"),this.m_itemSelectAll=e.querySelector(".acco-item-select-all"),this.m_itemSelectNone=e.querySelector(".acco-item-select-none"),this.m_checkbox=e.querySelectorAll(".acco-item-check"),this.m_modeSelect=!1,this.isValid()&&(this.m_itemSelectStart.addEventListener("click",(e=>this.onSelectStart(e))),this.m_itemSelectAll.style.display="none",this.m_itemSelectNone.style.display="none")}getCheckedItemIds(){const e=[];return this.m_checkbox.forEach((t=>{t.checked&&e.push(t.value)})),e}isModeSelect(){return this.m_modeSelect}isSelectAll(){return this.m_checkbox.length==this.getCheckedItemIds().length}isSelectNone(){return 0==getCheckedItemIds().length}isValid(){return this.m_itemSelectStart&&this.m_itemSelectAll&&this.m_itemSelectNone}onSelectStart(e){e.preventDefault(),this.m_itemSelectStart.style.display="none",this.m_itemSelectAll.style.display="inline-block",this.m_itemSelectNone.style.display="inline-block",this.m_checkbox.forEach((e=>{e.style.display="inline-block"})),this.m_itemSelectAll.addEventListener("click",(e=>this.onSelectAll(e))),this.m_itemSelectNone.addEventListener("click",(e=>this.onSelectNone(e))),this.m_modeSelect=!0}onSelectAll(e){e.preventDefault(),this.selectAll(!0)}onSelectNone(e){e.preventDefault(),this.selectAll(!1)}selectAll(e){this.m_checkbox.forEach((t=>{t.checked=e}))}}function c(){document.querySelectorAll(".formdata-manage").forEach((e=>{const t=new l(e);new o(e,t),new n(e,t);e.querySelectorAll(".submissions-dialog").forEach((t=>{new i(e,t)}))}))}}}]);
//# sourceMappingURL=mercury-formdata-manage.js.map?ver=ce5f23019900604a0f56