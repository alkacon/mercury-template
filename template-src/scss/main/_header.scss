// This program is part of the OpenCms Mercury Template.
//
// Copyright (c) Alkacon Software GmbH & Co. KG (http://www.alkacon.com)
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU Affero General Public License as
// published by the Free Software Foundation, either version 3 of the
// License, or (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU Affero General Public License for more details.
//
// You should have received a copy of the GNU Affero General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.

/**********
 * Source file: _header.scss
 */

@function calc-abs-col($breakpoint, $size, $max-widths: $container-max-widths, $columns: $grid-columns) {
    @return floor(map-get($max-widths, $breakpoint) * divide($size, $columns, $divide-precision));
}

@function calc-abs-col-rest($breakpoint, $offset, $max-widths: $container-max-widths) {
    $row-size: map-get($max-widths, $breakpoint);
    @return floor($row-size - $offset);
}

@mixin abs-col($max-width) {
    flex: 0 0 $max-width;
    max-width: $max-width;
}

@mixin make-abs-col($breakpoint, $size, $max-widths: $container-max-widths, $columns: $grid-columns) {
    $max-width: calc-abs-col($breakpoint, $size);
    @include abs-col($max-width);
}

@mixin hide-mega-menu-content {
     // hide all elements from mega menu that are not navigations
    .mega .nav-mega-menu {
        .teaser,
        .element:not(.type-nav-side):not(.ls-navigation) {
            display: none;
        }
        > .row > div {
            max-width: none;
            flex: none;
        }
    }
}

@mixin sticky-header-globals($breakpoint, $selector: '') {
    // sticky / fixed headers

    @include media-breakpoint-up($breakpoint) {

        .area-header#{$selector} {
            position: relative;

            .head {
                position: relative;
                min-height: $nav-header-total-height;
            }

            .sticky {
                // hide optional areas if css class is set
                > .isfixed .hidden-fixed,
                > .notfixed .hidden-notfixed {
                    display: none;
                }
            }

            #{conditional-value($nav-setting-fixheader != false, ".sticky.csssetting", ".sticky.default")},
            .sticky.always,
            .sticky.upscroll {
                // this requires JavaScript found in script-navigation.js to work properly
                > .isfixed {
                    position: fixed;
                    top: 0;
                    padding-top: 0;
                    width: 100%;
                    z-index: $above-oc-z-index; // z-index of sticky header must be well above OC points plus other elements
                    animation-duration: 1s;
                    animation-name: fixHeader;
                    opacity: $nav-head-fixed-opacity;
                    background-color: $fh-header-bg-color;
                    box-shadow: $nav-head-fixed-shadow;
                }
            }
        }

        html.opencms-page-editor {
            // fix head below toolbar in edit mode
            .area-header#{$selector} {
                #{conditional-value($nav-setting-fixheader != false, ".sticky.csssetting", ".sticky.default")},
                .sticky.always,
                .sticky.upscroll {
                    > .isfixed {
                        padding-top: $opencms-toolbar-height;
                    }
                }
            }
        }

        html.noscript {
            // JavaScript disabled navigation
            // displays the menu elements on hover if JavaScript is disabled
            .area-header#{$selector} .nav-main-items li.expand:hover > .nav-menu {
                display: block;
            }
        }
    }
}

@mixin add-bg-color($bg-color) {
    @if (($bg-color != none) and ($bg-color != $fh-header-bg-color)) {
        background-color: $bg-color;
        @content;
    }
}

@mixin add-meta($header-type, $padding-v: $default-margin-verysmall) {

    // meta links
    .h-meta {
        order: 8;
        display: flex;
        flex-grow: 0;
        flex-basis: auto;
        flex-direction: column;
        padding-top: $padding-v;

        .header-links {
            display: flex;
            flex-basis: auto;
        }
    }

    &.meta-left {
        .header-links {
            justify-content: flex-start;
        }
        @if ($header-type == "fh") {
            .h-info {
                .h-meta {
                    // make sure meta links are aligned to navigation
                    padding-left: $fh-grid-gutter-width-half;
                }
            }
        }
    }

    &.meta-center {
        .header-links {
            justify-content: center;
        }
    }

    &.meta-right {
        .header-links {
            justify-content: flex-end;
        }
    }

    &.meta-above {
        .h-meta {
            order: 1;
            @include add-bg-color($fh-meta-bg-color) {
                padding-bottom: $padding-v;
                li::before,
                li::after,
                a {
                    color: get-text-color($fh-meta-bg-color, $fh-meta-color);
                }
                a:hover {
                    color: get-text-color($fh-meta-bg-color, $fh-meta-hover-color);
                }
            }
        }
    }
}

// Flexible header with desktop menu
@if($feature-use-flexible-header) {

    // Special header containers
    @if ($nav-breakpoint-sticky-header != xs) {
        // sticky header is not enabled for mobile devices (this is the default)
        .co-sm-md {
            // container only for screen size SM And MD
            @include media-breakpoint-between(sm, lg) {
                @include make-container(0);
                max-width: map-get($container-max-widths, sm);
            }
            @include media-breakpoint-only(md) {
                max-width: map-get($container-max-widths, md);
            }
        }

        .co-lg-xl {
            // container only for screen size LG And XL
            @include media-breakpoint-up(lg) {
                @include make-container();
                max-width: map-get($container-max-widths, lg);
            }
            @include media-breakpoint-up(xl) {
                max-width: map-get($container-max-widths, xl);
            }
            @include media-breakpoint-up(xxl) {
                max-width: map-get($container-max-widths, xxl);
            }
        }
    } @else {
        .co-lg-xl {
            // sticky header is enabled for all devices (also mobile)
            @include media-breakpoint-between(sm, lg) {
                @include make-container(0);
                max-width: map-get($container-max-widths, sm);
            }
            @include media-breakpoint-only(md) {
                max-width: map-get($container-max-widths, md);
            }
            @include media-breakpoint-up(lg) {
                @include make-container();
                max-width: map-get($container-max-widths, lg);
            }
            @include media-breakpoint-up(xl) {
                max-width: map-get($container-max-widths, xl);
            }
            @include media-breakpoint-up(xxl) {
                max-width: map-get($container-max-widths, xxl);
            }
        }
    }

    header.fh {
        .h-meta,
        .h-title {
            display: none;
        }

        .h-logo {
            width: 100%;
            padding-top: var(--#{$prefix}default-margin-verysmall);
            padding-bottom: var(--#{$prefix}default-margin-verysmall);
            padding-right: $fh-grid-gutter-width-half;
            padding-left: $fh-grid-gutter-width-half;
        }

        .h-ac {
            display: none;
        }

        &.ac-mobile {
            .h-ac {
                display: block;

                > div,
                .container > div {
                    > .element {
                        margin-bottom: 0;
                    }
                }
            }

            &.ac-full-size {
                .h-ac {
                    // see https://css-tricks.com/full-width-containers-limited-width-parents/
                    width: 100vw;
                    position: relative;
                    left: 50%;
                    right: 50%;
                    margin-left: -50vw;
                    margin-right: -50vw;
                }
            }
        }

        .nav-main-mobile-logo {
            .mobile-logolink {
                display: flex;
            }
            .img-responsive {
                display: inline-block;
            }
        }

        @if ($fh-logo-image-bg != none) {
            // set colored background for image (if images contain transparency - required mostly for demo content)
            .nav-main-mobile-logo .img-responsive,
            .header-image {
                background-color: $fh-logo-image-bg;
            }
        }

        @include media-breakpoint-up(sm) {
            .h-logo {
                .header-image {
                    max-width: none;
                }
            }
        }

        @include media-breakpoint-down(lg) {
            @include hide-mega-menu-content;

            &.title-mobile {

                %expand-title {
                    display: flex; // will be hidden from screen size lg
                    order: 10;
                    padding-bottom: $bh-header-padding-small;
                    padding-top: $nav-mobile-toggle-top;
                    width: 100vw;
                    position: relative;
                    left: 50%;
                    right: 50%;
                    margin-left: -50vw;
                    margin-right: -50vw;

                    @include add-bg-color($fh-title-bg-color) {
                        padding-bottom: $nav-mobile-toggle-top;
                    }
                }

                %format-title {
                    @include use-hyphens-headings(true);
                    @include heading-base;
                    line-height: 1.2;
                    font-size: $bh-title-font-size-mobile;
                    text-align: left;
                    display: block;

                    @include add-bg-color($fh-title-bg-color) {
                        color: get-text-color($fh-title-bg-color, $fh-title-color);
                    }
                    @include make-container();
                    @include media-breakpoint-up(sm) {
                        max-width: map-get($container-max-widths, sm);
                    }
                    @include media-breakpoint-up(md) {
                        max-width: map-get($container-max-widths, md);
                    }
                }

                .h-info {
                    @extend %expand-title;

                    .h-meta {
                        display: none;
                    }

                    .h-title {
                        @extend %format-title;
                    }
                }

                &.lp-c {
                    .h-title {
                        @extend %expand-title;

                        > div {
                            @extend %format-title;
                        }
                    }
                    @if (($fh-title-bg-color != none) and ($fh-title-bg-color != $fh-header-bg-color)) {
                        &.ls-0 {
                            .h-title > div {
                                @if ($nav-mobile-smaller-xs-toggle) {
                                    min-height: round($nav-toggle-size-xs);
                                    @include media-breakpoint-up(sm) {
                                        min-height: $nav-toggle-size;
                                    }
                                } @else {
                                    min-height: round($nav-toggle-size);
                                }
                            }
                        }
                    }
                }

                &.title-left {
                    .h-title {
                        text-align: left;
                    }
                }

                &.title-center {
                    .h-title {
                        text-align: center;
                    }
                }

                &.title-right {
                    .h-title {
                        text-align: right;
                    }
                }
            }
        }

        @include media-breakpoint-up(lg) {

            .head {
                display: flex;
                flex-direction: column;
            }

            @if ($nav-head-border != none) {
                .header-group {
                    border-bottom: $nav-head-border;
                }
            }

            // logo and info column

            .h-logo {
                order: 4;
                display: flex;
                align-items: flex-end;
                width: 100%;
                > a.imglink {
                    width: 100%;
                    display: block;
                }
            }

            .h-group {
                order: 6;
                display: flex;
                position: relative;
                padding-right: 0;
                padding-left: 0;
            }

            .h-info {
                order: 6;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                width: 100%;

                > .h-nav {
                    align-items: flex-end;
                }

                > .h-title {
                    color: get-text-color($fh-header-bg-color, $fh-title-color);
                    background-color: transparent;
                }
            }

            &.lp-l {
                .h-info {
                    padding-right: $fh-grid-gutter-width-half;
                }
            }

            &.lp-c {
                .header-group .h-logo { // must make rule stronger than ls- rules below
                    margin-right: auto;
                    margin-left: auto;
                    flex: 0 0 auto;
                }
            }

            &.lp-r {
                .h-info {
                    order: 3;
                    .h-meta,
                    .h-title {
                        padding-left: $fh-grid-gutter-width-half;
                    }
                }
            }

            @include add-meta("fh");

            // page title

            .h-title {
                order: 10;
                display: flex;
                flex-direction: column;
                flex-basis: auto;
                flex-grow: 1000;
                @include heading-base;
                padding-top: var(--#{$prefix}default-margin-verysmall);
                padding-bottom: var(--#{$prefix}default-margin-verysmall);
                color: $fh-title-color;
                @if ($fh-title-bg-color != none) {
                    background-color: $fh-title-bg-color;
                }
                font-size: $fh-title-font-size;
                line-height: 1.2;
                width: 100%;
            }

            &.title-top {
                .h-title {
                    justify-content: flex-start;
                }
            }

            &.title-middle {
                .h-title {
                    justify-content: center;
                }
            }

            &.title-bottom {
                .h-title {
                    justify-content: flex-end;
                }
                &.nav-aside {
                    // add padding above nav if title sits directly over it
                    .h-nav {
                        padding-top: var(--#{$prefix}default-margin-verysmall);
                    }
                }
            }

            &.lp-r.title-default,
            &.title-left {
                .h-title {
                    align-self: flex-start;
                    text-align: left;
                }
                .h-info {
                    .h-title {
                        // make sure title is aligned to navigation
                        padding-left: $fh-grid-gutter-width-half;
                    }
                }
            }

            &.lp-c.title-default,
            &.title-center {
                .h-title {
                    align-self: center;
                    text-align: center;
                }
            }

            &.lp-l.title-default,
            &.title-right {
                .h-title {
                    align-self: flex-end;
                    text-align: right;
                }
            }

            // navigation

            .h-nav {
                order: 15;
                display: flex;
                flex-grow: 1;
                width: 100%;

                > .co-lg-xl {
                    display: flex;
                }
            }

            .nav-main-container {
                flex-basis: auto;
                flex-grow: 1;
            }

            &.nav-only {
                .h-info {
                    justify-content: flex-end;
                }
            }

            @if ($nav-breakpoint-desktop != none) {
                // these adjustments are only required in case there is a special desktop navigation
                &.nav-left {
                    .h-info .h-nav,
                    .h-nav .co-lg-xl {
                        // remove gutter from surrounding container
                        padding-left: $fh-grid-gutter-width-half - $nav-header-hor-padding;
                    }
                    .nav-main-items {
                        justify-content: flex-start;
                        > li > .nav-menu {
                            // adjust dropdown menu
                            left: $nav-header-hor-padding - $nav-menu-hor-padding;
                        }
                    }
                }

                &.nav-below {
                    .h-nav {
                        flex-basis: auto;
                        @if ($fh-nav-bg-color != none) {
                            background-color: $fh-nav-bg-color;
                            padding-top: $nav-header-ver-padding;
                            .nav-main-items > li > a {
                                $color-nav-text: get-text-color($fh-nav-bg-color, $nav-header-text);
                                color: $color-nav-text;
                                &::after {
                                    color: $color-nav-text;
                                }
                                &:hover {
                                    $color-nav-hover: get-text-color($fh-nav-bg-color, $nav-header-text-hover);
                                    color: $color-nav-hover;
                                    &::after {
                                        color: $color-nav-hover;
                                    }
                                }
                            }
                        }
                    }
                }

                // reduced navigation space

                &.nav-disp-reduced {
                    $fh-nav-header-reduction: 3px !default;
                    .nav-main-items > li {
                        > a {
                            padding-left: $nav-header-hor-padding - $fh-nav-header-reduction;
                            padding-right: $nav-header-hor-padding - $fh-nav-header-reduction;
                            &::after {
                                right: $nav-header-arrows-right;
                            }
                        }
                        > .nav-menu {
                            // adjust dropdown menu
                            left: $nav-header-hor-padding - $nav-menu-hor-padding - $fh-nav-header-reduction;
                        }
                    }
                }

                &.nav-disp-default,
                &.nav-disp-big  {
                    &.nav-left {
                        .h-info .h-nav,
                        .h-nav .co-lg-xl {
                            .nav-main-items > li > a {
                                // add padding increase to the right and adjust position of arrow down
                                padding-right: $nav-header-hor-padding + $fh-nav-header-padding-increase;
                                &::after {
                                    right: $nav-header-arrows-right + $fh-nav-header-padding-increase;
                                }
                            }
                        }
                    }

                    &.nav-center,
                    &.nav-right {
                        .nav-main-items > li {
                            > a {
                                // add padding increase to the left
                                padding-left: $nav-header-hor-padding + $fh-nav-header-padding-increase;
                            }
                            > .nav-menu {
                                // adjust dropdown menu
                                left: $fh-nav-header-padding-increase + $nav-header-hor-padding - $nav-menu-hor-padding;
                            }
                        }
                    }
                }

                &.nav-center,
                &.nav-right {
                    .nav-main-items > li {
                        &.nav-first {
                            > a {
                                padding-left: 0;
                            }
                            > .nav-menu {
                                left: -1 * $nav-header-hor-padding + $nav-header-hor-padding - $nav-menu-hor-padding;
                            }
                        }
                    }
                }

                &.nav-center {
                    .nav-main-items {
                        justify-content: center;
                        & > li:first-of-type > a {
                            padding-left: 0;
                        }
                    }
                }

                &.nav-disp-big {
                    .nav-main-items {
                        > li {
                            > a {
                                font-size: add-values($nav-header-font-size, 4px);
                            }
                        }
                    }
                }
            }


            // additional container

            .h-ac {
                display: block;
                order: 20;
                width: 100%;

                > div,
                .co-lg-xl > div {
                    > .element { // using '.element:last-of-type' would be better, but causes "jumps" on editor loading
                        margin-bottom: 0;
                    }
                }

                @if ($fh-ac-bg-color != none) {
                    background-color: $fh-ac-bg-color;
                }
            }

            &.header-isfixed:not(.fix-ac) {
                .h-ac {
                    display: none;
                }
            }

            &.ac-above-logo {
                .h-ac {
                    order: 2;
                    @if ($fh-ac-bg-color == none) {
                        // add top margin only if no bg color is set, colored bg and top margin looks crappy
                        margin-top: var(--#{$prefix}default-margin-verysmall);
                    }
                }

                &.ac-full-size {
                    .h-ac {
                        // full size container - remove top margin on the meta container
                        margin-top: 0;
                    }
                }
            }

            &.ac-below-logo {
                .h-ac {
                    order: 12;
                }
                &.nav-below:not(.lp-c) {
                    padding-top: $nav-header-ver-padding;
                }
            }

            // breadcrumbs

            .type-nav-breadcrumbs {
                display: flex;
            }

            &.bc-right {
                .type-nav-breadcrumbs {
                    justify-content: flex-end;
                }
            }

            &.bc-center {
                .type-nav-breadcrumbs {
                    justify-content: center;
                }
            }

            @if ($nav-breadcrumb-bg-color != none) {
                .h-bc {
                    background-color: $nav-breadcrumb-bg-color;
                    .nav-breadcrumbs {
                        padding-top: var(--#{$prefix}default-margin-small);
                        padding-bottom: var(--#{$prefix}default-margin-small);
                    }
                }
            }

            // centered logo

            &.lp-c {

                &.np-fixed.header-isfixed,
                &.np-always.nav-below {
                    .h-logo {
                        padding-bottom: 0;
                    }
                }

                .h-meta {
                    order: 0;
                }

                .h-title {
                    order: 1;
                }

                &.title-bottom {
                    .h-title {
                        order: 10;
                    }
                }

                &.title-top {
                    .h-title {
                        order: -1;
                    }
                }
            }

            // variable paddings

            $logo-paddings: ('no': 0, 'sm': $default-margin-verysmall, 'md': $default-margin-small, 'lg': $default-margin);

            @each $padding-size in ('no','sm','md','lg') {
                &.pad-#{$padding-size} {
                    $logo-padding: map-get($logo-paddings, $padding-size);
                    .h-logo {
                        padding-top: $logo-padding;
                        padding-bottom: $logo-padding;
                    }
                    @if ($logo-padding > 0) {
                        .h-meta {
                            padding-top: $logo-padding;
                            padding-bottom: 0;
                        }
                        @if ($fh-meta-bg-color != none) {
                            &.meta-above {
                                .h-meta {
                                    padding-bottom: $logo-padding;
                                }
                            }
                        }
                        &.lp-c {
                            .h-logo,
                            .h-title {
                                padding-top: $logo-padding;
                                padding-bottom: 0;
                            }
                            &.ls-0 {
                                .h-title {
                                    padding-bottom: $logo-padding;
                                }
                            }
                            @if ($fh-title-bg-color != none) {
                                .h-title {
                                    padding-bottom: $logo-padding;
                                }
                            }
                            @if ($fh-nav-bg-color != none) {
                                .h-logo {
                                    padding-bottom: $logo-padding;
                                }
                            }
                            .h-ac {
                                margin-top: $logo-padding;
                            }
                        }
                    }
                    @if ($logo-padding > $default-margin-verysmall) {
                        @if ($fh-ac-bg-color == none) {
                            // additional container should add margins only if not colored
                            &.ac-below-logo {
                                &.nav-aside {
                                    // additional container below logo and navigation
                                    .h-ac {
                                        margin-bottom: $logo-padding;
                                    }
                                }
                                @if ($fh-nav-bg-color != none) {
                                    &.nav-below {
                                        // colored navigation below additional container
                                        .h-ac {
                                            margin-bottom: $logo-padding;
                                        }
                                    }
                                }
                            }
                            @if ($fh-nav-bg-color != none) {
                                &.ac-below-nav {
                                    .h-ac {
                                        // colored navigation above and below additional container
                                        margin-bottom: $logo-padding;
                                        margin-top: $logo-padding;
                                    }
                                }
                            }
                        }
                        &.header-notfixed,
                        &.header-isfixed.fix-complete,
                        &.header-isfixed.ls-0.fix-compact {
                            .h-nav {
                                padding-bottom: calc(#{$logo-padding} - #{$nav-header-ver-padding});
                            }
                            &.nav-below {
                                // if nav is below we need a padding on top (aside not)
                                .h-nav {
                                    padding-top: $logo-padding;
                                }
                                &.title-bottom {
                                    // if title is at bottom add padding otherwise it will not be aligned with logo
                                    .h-info .h-title {
                                        padding-bottom: $logo-padding;
                                    }
                                }
                            }
                        }
                    }
                    @if (($logo-padding == $default-margin-verysmall) and ($fh-title-bg-color != none)) {
                        &.header-notfixed,
                        &.header-isfixed.fix-complete {
                            &.nav-below {
                                // we need a padding on top if the background is colored
                                .h-nav {
                                    padding-top: $logo-padding;
                                }
                            }
                        }
                    }
                }
            }

            // pull up effect for navigation

            &.np-fixed.header-isfixed,
            &.np-always {
                &.nav-below {
                    .h-nav {
                        margin-top: #{-1 * ($nav-header-total-height + $nav-header-ver-padding)};
                        z-index: #{$overflow-z-index + 10};
                        padding-top: $nav-header-ver-padding;
                        @if ($fh-nav-bg-color != none) {
                            background-color: rgba($fh-nav-bg-color, 0.7);
                        } @else {
                            background-color: rgba($fh-header-bg-color, 0.7);
                        }
                    }
                    &.lp-r {
                        .nav-main-items {
                            margin-right: 0;
                        }
                    }
                    &.lp-l {
                        .nav-main-items {
                            margin-left: 0;
                        }
                    }
                }
            }

            // fixed header

            &.header-isfixed {
                &.fix-overlay,
                &.fix-compact {
                    .h-title {
                        display: none;
                    }
                }

                $fixed-logo-padding: map-get($logo-paddings, 'sm');

                &.fix-compact,
                &.fix-overlay {
                    .h-logo {
                        padding-top: $fixed-logo-padding;
                        padding-bottom: $fixed-logo-padding;
                    }
                    &.padding-none {
                        .h-logo {
                            padding-top: 0;
                            padding-bottom: 0;
                        }
                    }
                }

                &.fix-compact {
                    &.meta-above {
                        .h-meta {
                            padding-top: $fixed-logo-padding;
                            @if ($fh-meta-bg-color != none) {
                                padding-bottom: $fixed-logo-padding;
                            }
                        }
                    }
                }

                &.fix-overlay {
                    .h-meta {
                        display: none;
                    }
                    .h-logo {
                        position: absolute;
                        background-color: transparent;
                        left: 0;
                        z-index: #{$overflow-z-index + 20};
                        &::before,
                        &::after {
                            display: block;
                            content: "";
                            position: absolute;
                            top: $nav-header-total-height;
                            left: calc(#{$fh-grid-gutter-width-half} - #{$fixed-logo-padding});
                            width: calc(100% - #{$fh-grid-gutter-width} + #{2 * $fixed-logo-padding});
                            height: calc(100% - #{$nav-header-total-height});
                            box-shadow: 0 8px 10px -4px $dropshadow;
                            background-color: $fh-header-bg-color;
                        }
                        &::after {
                            top: 0;
                            height: #{$nav-header-total-height};
                            box-shadow: none;
                            z-index: -1;
                        }
                    }
                    .h-nav {
                        margin-top: 0; // unset optional negative margin for pulled up nav
                        padding-top: $nav-header-ver-padding;
                    }
                    &.lp-r {
                        .h-logo {
                            left: auto;
                            right: 0;
                        }
                    }
                    &.lp-l {
                        .h-nav,
                        .h-nav > .co-lg-xl {
                            justify-content: flex-end;
                        }
                    }
                    &.padding-none {
                        .h-logo {
                            &::before {
                                left: $fh-grid-gutter-width-half;
                                width: calc(100% - #{$fh-grid-gutter-width});
                            }
                        }
                    }
                }
            }
        } // breakpoint lg

        // variable logo sizes

        @each $logo-size in (1,2,3,4,5,6,12) {
            &.ls-#{$logo-size} {
                .h-logo {
                    @include make-col(nth([4,5,7,9,9,9,12,12,12,12,12,12], $logo-size));
                }
                @if ($logo-size < 6) {
                    .nav-main-mobile-logo .mobile-logolink {
                        width: calc-abs-col(lg, $logo-size) - $fh-grid-gutter-width;
                        max-width: 100%;
                    }
                }
                @include media-breakpoint-up(sm) {
                    .h-logo {
                        @if ($logo-size < 12) {
                            @include make-abs-col(lg, $logo-size);
                        } @else {
                            @include make-col($logo-size);
                        }
                    }
                }
                @include media-breakpoint-up(lg) {
                    &.header-isfixed {
                        &.fix-compact {
                            .h-logo {
                                max-width: floor((calc-abs-col(xl, $logo-size) - $fh-grid-gutter-width) * 0.5) + $fh-grid-gutter-width;
                            }
                        }
                        &.fix-overlay {
                            .nav-main-container {
                                max-width: calc(100% - #{calc-abs-col(lg, $logo-size)});
                            }
                        }
                    }
                }
                @include media-breakpoint-up(xl) {
                    .h-logo {
                        @include make-abs-col(xl, $logo-size);
                    }
                    &.header-isfixed {
                        &.fix-overlay {
                            .nav-main-container {
                                max-width: calc(100% - #{calc-abs-col(xl, $logo-size)});
                            }
                        }
                    }
                }
            }
        }

        &.ls-0 {
            .h-logo {
                display: none;
            }
            .nav-main-mobile-logo {
                min-height: calc(#{$nav-mobile-toggle-top + $nav-toggle-size} + #{$nav-mobile-line-padding});
            }
        }

        @if (false) {
            // colored backgrounds - for debugging only

            background-color: #333 !important;

            .head {
                background-color: #666 !important;
            }
            .header-group {
                background-color: #999;
            }
            .h-meta {
                background-color: #C1D8ED;
            }
            .h-meta > .co-lg-xl {
                background-color: #8FB8DE;
            }
            .h-group {
                background-color: #ccc;
            }
            .h-logo {
                background-color: #9B5094;
            }
            .h-title {
                background-color: #D591AD;
            }
            .h-title > .co-lg-xl {
                background-color: #A40E4C;
            }
            .h-nav {
                background-color: #C1D8ED;
            }
            .h-nav > .co-lg-xl {
                background-color: #8FB8DE;
            }
            .h-bc {
                background-color: #F8CC8B;
            }
            .h-bc > .container {
                background-color: #F18F01;
            }
            .h-ac {
                background-color: #FBABD3;
            }
            .h-ac > .co-lg-xl {
                background-color: #F865B0;
            }
        }
    }
}

@mixin mobile-menu-globals($logo-position) {

    $toggle-position: conditional-value($logo-position == left, right, left);
    $position-selector: conditional-value($logo-position == left, "lp-l", "lp-r");

    header.bh.#{$position-selector} {
        // nav menu is hidden
        .nav-main-container {
            #{$toggle-position}: -1 * $nav-mobile-width-xs;
            transition: #{$toggle-position} 0.5s, opacity 0.25s;
            > .nav-main-group {
                display: none;
            }
        }
    }

    html.active-nav header.bh.#{$position-selector} {
        // nav menu is active
        .nav-main-container {
            opacity: 1;
            #{$toggle-position}: 0;
            > .nav-main-group {
                display: block;
            }
        }
    }
}


































// Header that always displays the"burger" menu
@if ($feature-use-burger-header) {

    @include sticky-header-globals(xs, '.fix-xs');
    @include sticky-header-globals(sm, '.fix-sm');
    @include sticky-header-globals(md, '.fix-md');
    @include sticky-header-globals(lg, '.fix-lg');

    @include mobile-menu-globals(right);
    @include mobile-menu-globals(left);

    header.bh {

        .head {
            display: flex;
            flex-direction: column;
        }

        .h-meta {
            display: none;
        }

        .h-logo-row {
            display: flex;
            order: 6;
            padding-top: $bh-header-padding;
            padding-bottom: $bh-header-padding;
            justify-content: space-between;
        }

        .h-logo-col {
            display: flex;
            align-items: center;

            .h-logo {
                width: 100%;
                display: block;

                > a.imglink {
                    width: 100%;
                    display: block;
                }
            }
        }

         .h-toggle-col {
            display: flex;
            align-items: center;
            max-width: $nav-toggle-size-with-border;
            min-width: $nav-toggle-size-with-border;
        }

        .h-title-row {
            display: flex; // will be hidden from screen size lg
            order: 10;
            padding-bottom: $bh-header-padding-small;

            @include add-bg-color($fh-title-bg-color) {
                padding-top: $bh-header-padding-small;
                .h-title {
                    color: get-text-color($fh-title-bg-color, $fh-title-color);
                }
            }
        }

        &.ls-col {
            .h-logo-col {
                .h-logo {
                    > a.imglink {
                        width: 100%;
                        display: block;
                    }
                }
            }

            .h-title-col {
                display: none; // will be revealed in screen size lg below
                align-items: center;
                flex-grow: 10000;
                order: 2;

                padding-right: $fh-grid-gutter-width;
                padding-left: $fh-grid-gutter-width;

                .h-title {
                    width: 100%;
                    color: get-text-color($fh-header-bg-color, $fh-title-color);
                }
            }
        }

        &.ls-12 {
            .h-logo-row {
                position: relative;
            }
            .h-logo-col {
                width: 100%;
            }
            .h-title-col {
                display: none;
            }
            .h-toggle-col {
                position: absolute;
                top: 0;
                bottom: 0;
            }
            &.lp-l {
                .h-toggle-col {
                    right: $fh-grid-gutter-width-half;
                }
            }
            &.lp-r {
                .h-toggle-col {
                    left: $fh-grid-gutter-width-half;
                }
            }
        }

        &.lp-l {
            .h-logo-col {
                order: 1;
            }
            .h-toggle-col {
                order: 3;
                justify-content: flex-end;
                margin-right: -1 * $nav-toggle-border-width;
            }
            .h-logo-row .h-title {
                text-align: right;
            }
            .h-title-row .h-title {
                text-align: left;
            }
        }

        &.lp-r {
            .h-logo-col {
                order: 3;
            }
            .h-toggle-col {
                order: 1;
                justify-content: flex-start;
                margin-left: -1 * $nav-toggle-border-width;
            }
            .h-logo-row .h-title {
                text-align: left;
            }
            .h-title-row .h-title {
                text-align: left;
            }
        }

        &.title-left {
            .h-logo-row .h-title,
            .h-title-row .h-title,
            .h-ac .h-ac-title {
                text-align: left;
            }
        }

        &.title-right {
            .h-logo-row .h-title,
            .h-title-row .h-title,
            .h-ac .h-ac-title {
                text-align: right;
            }
        }

        &.title-center {
            .h-logo-row .h-title,
            .h-title-row .h-title,
            .h-ac .h-ac-title {
                text-align: center;
            }
        }

        .h-title {
            font-size: $bh-title-font-size-mobile;
        }

        .h-title,
        .h-ac .h-ac-title {
            @include use-hyphens-headings(true);
            line-height: 1.2;
            @if ($font-family-headings != $font-family-base) {
                font-family: $font-family-headings;
            }
            @if ($font-style-headings != normal) {
                font-style: $font-style-headings;
            }
        }

        // additional container

        .h-ac {
            display: block;
            order: 20; // default: display below
            position: relative;
            @include add-bg-color($fh-ac-bg-color);

            > div,
            .h-ac-element > div,
            .co-lg-xl > div {
                > .element { // using '.element:last-of-type' would be better, but causes "jumps" on editor loading
                    margin-bottom: 0;
                }
            }

            .h-ac-title {
                position: absolute;
                left:50%;
                top:50%;
                pointer-events: none;
                z-index: #{$overflow-z-index + 2};
                transform: translate(-50%, -50%);

                margin: 0;
                font-weight: $font-weight-bold;
                color: $text-light;
                text-shadow: 0 0 10px rgba(0,0,0,0.75);

                font-size: $bh-title-ac-font-size-mobile;
            }
        }

        &.ac-above-logo {
            .h-ac {
                order: 2;
                @if (($fh-ac-bg-color == none) or ($fh-ac-bg-color == $fh-header-bg-color)) {
                    // add top margin only if no bg color is set, colored bg and top margin looks crappy
                    margin-top: $bh-header-padding;
                }
            }
            &.ac-full-size {
                .h-ac {
                    // full size container - remove top margin on the meta container
                    margin-top: 0;
                }
            }
        }

        &.header-isfixed {
            .h-ac {
                display: none;
            }
        }

        // remove rounded corners from all images and slider
        .image-src-box,
        .type-slider .slide-wrapper,
        .type-slider .slider-box {
            border-radius: 0;
        }

        .nav-toggle-label {
            margin: 0;
        }

        &.fixtoggle {
            #nav-toggle-label-open {
                position: fixed;
                z-index: $above-oc-z-index + 198;
            }
        }

        #nav-toggle-label-open .nav-toggle {
            width: $nav-toggle-size-with-border;
            height: $nav-toggle-size-with-border;
            border: $nav-toggle-border-width solid #fff;
        }

        @if ($nav-mobile-box-border-radius != 0) {
            // use border radius from boxes below also for toggle icon in nav menu
            #nav-toggle-label-close .nav-toggle {
                border-radius: $nav-mobile-box-border-radius;
            }
        }

        .nav-menu-header {
            // implies .lp-r, lp-l is handled below
            display: flex;
            background-color: $nav-mobile-logo-bg-color;
            padding: $bh-header-padding $nav-mobile-indent-offset;

            .nav-menu-toggle {
                display: flex;
                align-items: center;
                padding-right: $fh-grid-gutter-width;
            }

            .nav-menu-logo {
                display: flex;
                flex-grow: 1000;
                align-items: center;
                justify-content: flex-end;

                .mobile-logolink {
                    display: flex;
                    width: 100%;
                    max-width: $bh-nav-mobile-logo-max-width;
                }
            }
        }

        &.lsr-04 .nav-menu-header .nav-menu-logo .mobile-logolink {
            width: 80%;
        }

        &.lsr-08 .nav-menu-header .nav-menu-logo .mobile-logolink {
            width: 60%;
        }

        &.lsr-12 .nav-menu-header .nav-menu-logo .mobile-logolink {
            width: 40%;
        }

        &.lp-l {
            .nav-menu-header {
                .nav-menu-toggle {
                    order: 2;
                    padding-right: 0;
                    padding-left: $fh-grid-gutter-width;
                }

                .nav-menu-logo {
                    order: 1;
                    justify-content: flex-start;
                }
            }
            &.ls-0 {
                 .nav-menu-header {
                    justify-content: flex-end;
                }
            }
        }

        .nav-main-items {
            // this expands the arrow links to the right so they can be touch-clicked easier
            li.expand > a::after {
                right: $nav-mobile-toggle-side;
            }
            li.expand > a {
                padding-right: $nav-mobile-toggle-side + $nav-mobile-box-height !important;
            }

            .nav-meta-icons > ul {
                margin: 0;
                padding: 0 $nav-mobile-indent-offset;
                border-bottom: $nav-mobile-border;

                > li {
                    display: inline-block;

                    > a {
                        display: inline-block;
                        border-bottom: none;
                        font-size: $nav-mobile-line-height;
                        padding-left: 0;
                        padding-right: 0;
                        margin-right: round($nav-mobile-line-height * 0.5);

                        .fa {
                            min-width: $nav-mobile-line-height;
                        }
                    }
                }
            }
        }

        .nav-mega-menu .nav-side li > a {
            padding-left: #{$nav-mobile-toggle-side + ($nav-mobile-indent * 2)};
        }

        // hide content elements in mega menu (mega menu may be from a site using a different header type)
        @include hide-mega-menu-content;

        @include media-breakpoint-down(sm) {
            // reduce nav menu padding on very small screens

            .nav-menu-header {
                padding-left: $nav-mobile-toggle-side-xs;
                padding-right: $nav-mobile-toggle-side-xs;
            }

            .nav-main-items {
                li > a {
                    padding-left: $nav-mobile-toggle-side-xs;
                }
                li.expand > a::after {
                    right: $nav-mobile-toggle-side-xs;
                }
                li.expand > a {
                    padding-right: $nav-mobile-toggle-side-xs + $nav-mobile-box-height !important;
                }
            }

            .nav-mega-menu .nav-side li > a {
                padding-left: #{$nav-mobile-toggle-side-xs + $nav-mobile-indent};
            }

           .nav-menu {
                // menus below the head navbar
                > li > a {
                    padding-left: #{$nav-mobile-toggle-side-xs + $nav-mobile-indent};
                }
                > li > ul > li > a {
                    padding-left: #{$nav-mobile-toggle-side-xs + ($nav-mobile-indent * 2)};
                }
                > li > ul > li > ul > li a {
                    padding-left: #{$nav-mobile-toggle-side-xs + ($nav-mobile-indent * 3)};
                }
                > li > ul > li > ul > li > ul > li a {
                    padding-left: #{$nav-mobile-toggle-side-xs + ($nav-mobile-indent * 4)};
                }
            }
        }


        @if ($nav-head-border != none) {
            .header-group {
                border-bottom: $nav-head-border;
            }
        }

        // fixed header

        &.header-isfixed {

            .h-logo-row {
                @if (($fh-meta-bg-color != none) and ($fh-meta-bg-color != $fh-header-bg-color)) {
                    padding-top: $bh-header-padding-small;
                    padding-bottom: $bh-header-padding-small;
                } @else {
                    padding-top: $bh-header-padding-verysmall;
                    padding-bottom: $bh-header-padding-verysmall;
                }
            }

            .h-title-col,
            .h-title-row {
                display: none;
            }

            &.ls-12 {
                &.lp-r .h-logo {
                    margin-left: auto;
                }
                &.lp-l .h-logo {
                    margin-right: auto;
                }
                .h-logo {
                    max-width: 50%;
                }
            }
        }

        // remove padding for full size logo, also overrule .header-isfixed
        &.ls-12 {
            .h-logo-row {
                padding-top: 0;
                padding-bottom: 0;
            }
        }

        // variable logo sizes

        @each $logo-size in (1,2,3,4,5,6) {
            &.ls-#{$logo-size} {

                .h-logo-col {
                    width: calc-abs-col(sm, $logo-size);
                }
                &.header-isfixed {
                    .h-logo-col {
                        width: calc-abs-col(sm, $logo-size);
                    }
                }

                $logo-px-size-md: calc-abs-col(md, $logo-size) - $fh-grid-gutter-width;
                $logo-px-size-lg: calc-abs-col(lg, $logo-size) - $fh-grid-gutter-width;
                $logo-px-size-xl: calc-abs-col(xl, $logo-size) - $fh-grid-gutter-width;
                $toggle-offset: $nav-toggle-size + $nav-toggle-border-width + $fh-grid-gutter-width;

                @include media-breakpoint-up(md) {

                    .h-logo-col {
                        @include abs-col($logo-px-size-md);
                    }
                    .h-title-col {
                        @include abs-col(calc-abs-col-rest(md, $logo-px-size-md + $toggle-offset));
                    }
                }
                @include media-breakpoint-up(lg) {
                    .h-logo-col {
                        @include abs-col($logo-px-size-lg);
                    }
                    .h-title-col {
                       @include abs-col(calc-abs-col-rest(lg, $logo-px-size-lg + $toggle-offset));
                    }
                    &.header-isfixed {
                        .h-logo-col {
                            @include abs-col($logo-px-size-md);
                        }
                        .h-title-col {
                            @include abs-col(calc-abs-col-rest(lg, $logo-px-size-md + $toggle-offset));
                        }
                    }
                }
                @include media-breakpoint-up(xl) {
                    .h-logo-col {
                        @include abs-col($logo-px-size-xl);
                    }
                    .h-title-col {
                        @include abs-col(calc-abs-col-rest(xl, $logo-px-size-xl + $toggle-offset));
                    }
                    &.header-isfixed {
                        .h-title-col {
                            @include abs-col(calc-abs-col-rest(xl, $logo-px-size-md + $toggle-offset));
                        }
                    }
                }
            }
        }

        @include media-breakpoint-up(lg) {

            &.header-isfixed.ls-col .h-title-col,
            &.show-title.ls-col .h-title-col {
                display: flex;
            }

            &.ls-col .h-title-row {
                display: none;
            }

            .h-title {
                font-size: $bh-title-font-size;
            }
            .h-ac .h-ac-title {
                font-size: $bh-title-ac-font-size;
            }

            @include add-meta("bh", $bh-header-padding-meta);

            // breadcrumbs

            .type-nav-breadcrumbs {
                display: flex;
            }

            &.bc-right {
                .type-nav-breadcrumbs {
                    justify-content: flex-end;
                }
            }

            &.bc-center {
                .type-nav-breadcrumbs {
                    justify-content: center;
                }
            }

            @if ($nav-breadcrumb-bg-color != none) {
                .h-bc {
                    background-color: $nav-breadcrumb-bg-color;
                    .nav-breadcrumbs {
                        padding: $nav-breadcrumb-colored-padding;
                    }
                }
            }
        } // breakpoint lg

    }
}

@if($feature-use-flexible-header or $feature-use-burger-header) {

    .area-header {
        @if ($nav-header-margin-bottom > 0) {
            margin-bottom: $nav-header-margin-bottom;
        }
        &.no-margin {
            margin-bottom: 0;
        }

        .type-nav-breadcrumbs.element {
            // remove element bottom margin from breadcrumbs in header
            margin-bottom: 0;
        }

        // Header formatted link sequence
        .header-links {
            margin: 0;
            &.oc-small-element {
                min-height: auto !important;
            }

            > ul {
                display: flex;
                flex-direction: row;
                justify-content: flex-end;

                font-size: $fh-meta-font-size;
                @if ($nav-meta-font-family != $font-family-base) {
                    font-family: $nav-meta-font-family;
                }

                > li {
                    &:not(:last-child) {
                        &::after {
                            border-right-color: $nav-border;
                        }
                    }

                    > a {
                        color: $fh-meta-color;
                        text-transform: $fh-meta-text-transform;

                        &:hover {
                            text-decoration: none;
                            color: $fh-meta-hover-color;
                        }
                    }
                }
            }
            &.cap-none {
                > ul > li > a {
                    text-transform: none;
                }
            }
        }
    }

    .type-header-config {
        // Special formatting for flexible header configuration function
        background-color: $con-col-purple;
        color: $con-text-col-dark !important;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        line-height: 30px;
    }
}

@if($feature-use-flexible-header) {

    // Deprecated "logo-left" header - CSS comes with flexible header
    .area-header {

        // global variables are now mostly for flexible header, this is for backward compatibility
        $logo-left-nav-padding: 0 20px $nav-header-ver-padding 20px !default; // padding for main nav items in LG, XL
        $logo-left-arrow-right: 5px !default; // offset for arrow on main nav items in LG, XL
        $logo-left-menu-left: 20px - $nav-menu-hor-padding !default; // position offset for 2nd level menus in LG, XL
        $header-image-ribbon-bg: $fh-ac-bg-color !default; // background color for image ribbon in header
        $header-logo-xs-width: 270px !default; // max width for logo on XS screens (subtract 2 * $gutter)
        $header-logo-fixed-width: 250px !default; // max width for logo if fixed header (subtract 2 * $gutter)

        &.logo-left {
            .header-links,
            .header-title {
                display: none;
            }

            .col-head-logo {
                padding-top: var(--#{$prefix}default-margin-verysmall);
                padding-bottom: var(--#{$prefix}default-margin-verysmall);

                @include make-col(9);
                max-width: $header-logo-xs-width;
            }

            @if ($fh-logo-image-bg != none) {
                // set colored background for images (if images contain transparency)
                .nav-main-mobile-logo .img-responsive,
                .header-image {
                    background-color: $fh-logo-image-bg;
                }
            }

            .visual-top-bg {
                background-color: $header-image-ribbon-bg;
            }

            @include media-breakpoint-down(lg) {
                @include hide-mega-menu-content;
            }

            @include media-breakpoint-up(sm) {
                .col-head-logo {
                    @include make-col(6);

                    .header-image {
                        max-width: none;
                    }
                }
            }

            @include media-breakpoint-up(md) {
                .col-head-logo {
                    @include make-col(5);
                }
            }

            @include media-breakpoint-up(lg) {
                .col-head-logo {
                     @include make-col(4);

                    .header-image {
                        max-width: none;
                    }
                }

                .isfixed {
                    .col-head-logo {
                        max-width: $header-logo-fixed-width;
                    }
                    .visual-top-bg {
                        display: none;
                    }
                    .pull-up-fixed {
                        margin-top: -1 * $nav-header-total-height;
                    }
                }

                .header-group {
                    border-bottom: $nav-side-border;
                }

                .nav-main-container,
                .header-links,
                .header-title {
                    display: flex;
                    align-self: flex-end;
                    flex-direction: column;
                }

                .col-head-info {
                    padding-top: var(--#{$prefix}default-margin-verysmall);
                    padding-left: 0; // remove bootstrap gutter here to extend space available for menu items
                    display: flex;
                    flex-direction: column;
                }

                .header-title {
                    @include heading-base;
                    padding-top: var(--#{$prefix}default-margin-verysmall);
                    padding-bottom: var(--#{$prefix}default-margin-verysmall);
                    flex-basis: auto;
                    flex-grow: 10;
                    justify-content: center;
                    font-size: $fh-title-font-size;
                    line-height: 1;
                    text-align: right;
                }

                .nav-main-container {
                    flex-basis: auto;
                    flex-grow: 1;
                    display: flex;
                    justify-content: flex-end;
                }

                .nav-main-items > li {
                    > a {
                        padding: $logo-left-nav-padding;
                        &::after {
                            right: $logo-left-arrow-right;
                        }
                    }
                    > .nav-menu {
                        // adjust dropdown menu
                        left: $logo-left-menu-left;
                    }
                }
            }
        }
    }
}

// Header formatting for sticky header

@keyframes fixHeader {
    from {
        opacity: 0;
        transform: translate3d(0, -100%, 0);
    }

    to {
        opacity: $nav-head-fixed-opacity;
        transform: none;
    }
}


.head {
    background: $fh-header-bg-color;
}

@if (not $feature-use-burger-header) {
    // sticky / fixed header
    @include sticky-header-globals($nav-breakpoint-sticky-header);
}

// Adjustments for header in model group editor

html.opencms-group-editor {

    &.opencms-page-editor {
        // in group editor AND page edit mode is active

        .area-header .sticky {
            // overrule all hidden / fixed elements if edit mode is active
            > .isfixed .hidden-fixed,
            > .notfixed .hidden-notfixed {
                display: block;
                opacity: .5;
                background-image: $disabled-bg;
            }
        }

        @include media-breakpoint-down(lg) {

            .area-header {
                .hidden-xs,
                .hidden-sm,
                .hidden-md {
                    display: flex !important;
                    opacity: .5;
                    background-image: $disabled-bg;
                }
            }
        }

        &:not(.active-nav) {
            .area-header.bh {
                // show navigation container
                .h-nav {
                    border-top: 4px solid $con-col-purple !important;
                    background-color: rgba($con-col-purple, 0.75) !important;
                }

                .nav-main-container {
                    position: static;
                    height: auto;
                    width: auto;
                    right: auto;
                    left: auto;
                    opacity: initial;
                    background-color: transparent;
                    transition: none;

                    .nav-main-group {
                        display: block;

                        &.has-sidelogo {
                            padding-top: 0;
                        }
                    }
                }
            }
        }

        header.fh,
        header.bh {
            &.ls-0 {
                .h-logo {
                    display: block;
                    position: absolute;
                    width: 125px;
                    height: 25px;
                    padding: 0;
                    @include oct-meta-bg;

                    > .no-image {
                        position: absolute;
                        width: 125px;
                        height: 25px;
                        right: 0;
                        padding-bottom: 0 !important;
                    }
                }
            }
        }
        header.fh.ls-0 {
            &.title-left {
                .h-logo {
                    right: 0;
                }
            }
        }
        header.bh.ls-0 {
            &.lp-r {
                .h-logo-col {
                    position: relative;
                }
                .h-logo {
                    right: 0;
                }
            }
        }
    }

    .area-header {
        // remove default head bottom margin in model group editor */
        margin-bottom: 0;
    }
}